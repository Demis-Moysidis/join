<section>
    <header>
        <h1>Add Task</h1>
        <a>X</a>
    </header>

    <form (ngSubmit)="onSubmit(taskForm)" #taskForm="ngForm" class="task-form">
        <main>
            <div class="left_box">
                <div>
                    <label for="title"></label>
                    <input type="text" name="title" id="title" [(ngModel)]="newTask.title" #titleInput="ngModel"
                        pattern=# placeholder="Title" required>
                </div>

                <div class="error">
                    @if (titleInput.invalid && (titleInput.errors?.['pattern'] || titleInput.dirty || titleInput.touched
                    || taskForm.submitted)) {
                    <span>
                        @if (titleInput.errors?.['required']) {
                        UPS Vergessen
                        }@else if (titleInput.errors?.['pattern']) {
                        falsch
                        }
                    </span>
                    }
                </div>

                <div>
                    <label for="description"></label>
                    <textarea type="text" name="description" id="description" [(ngModel)]="newTask.description"
                        placeholder="Description" required></textarea>
                </div>

                <div class="error"></div>

                <div>
                    <label for="date"></label>
                    <input type="date" name="due_date" id="date" [(ngModel)]="newTask.due_date" #dateInput="ngModel"
                        pattern=# placeholder="Title" required>
                </div>

                <div class="error">
                    @if (dateInput.invalid && (dateInput.errors?.['pattern'] || dateInput.dirty || dateInput.touched ||
                    taskForm.submitted)) {
                    <span>
                        @if (dateInput.errors?.['required']) {
                        UPS Vergessen
                        }@else if (dateInput.errors?.['pattern']) {
                        falsch
                        }
                    </span>
                    }
                </div>
            </div>

            <div></div>

            <div class="right_box">
                <div>
                    <label for="priority">priority</label>
                    <select name="priority" id="priority" [(ngModel)]="newTask.priority">
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>

                <div class="error"></div>

                <div class="assigned">
                    <label for="assigned">Assign contacts</label>
                    @for (contact of contactService.contactsList; track $index) {
                    <div>
                        <input type="checkbox" id="assigned" [value]="contact"
                            (change)="toggleAssigned(contact, $event)">
                        {{ contact.name }}
                    </div>
                    }
                </div>

                <div class="error"></div>

                <div>
                    <label for="category">category</label>
                    <select type="text" name="category" id="category" [(ngModel)]="newTask.category"
                        placeholder="Category" #categoryInput="ngModel" pattern=#>
                        <option value="todo">Technical Task</option>
                        <option value="in-progress">User Story</option>
                    </select>
                </div>

                <div class="error">
                    @if (categoryInput.invalid && (categoryInput.errors?.['pattern'] || categoryInput.dirty ||
                    categoryInput.touched || taskForm.submitted)) {
                    <span>
                        @if (categoryInput.errors?.['required']) {
                        UPS Vergessen
                        }@else if (categoryInput.errors?.['pattern']) {
                        falsch
                        }
                    </span>
                    }
                </div>

                <div class="subtasks">
                    <label for="subtask">Add Subtask</label>
                    <input type="text" id="subtask" [(ngModel)]="subtaskTitle" name="subtaskTitle" placeholder="Subtask title">
                    <button type="button" (click)="addSubtask()">Add</button>
                    @for (subtask of newTask.subtask; track $index) {
                    <ul>
                        <li>
                            {{ subtask.title }}
                            <button type="button" (click)="removeSubtask($index)">x</button>
                        </li>
                    </ul>
                    }
                </div>

                <div class="error"></div>
            </div>
        </main>

        <footer>
            <div>
                <p>*This field is required</p>
            </div>

            <div>
                <button (click)="clearInputFields()">Clear<img src=""></button>
                <button type="submit">Add Task</button>
            </div>
        </footer>
    </form>
</section>