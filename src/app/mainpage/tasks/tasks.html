<section>
    <header>
        <h1>{{ editMode ? 'Edit Task' : 'Add Task' }}</h1>
        <button class="clear" (click)="onExit()">
            {{ editMode ? 'Cancel Edit' : 'Clear' }}
            <img src="/assets/icons/button_x_check/button_x.png">
        </button>
    </header>

    <form (ngSubmit)="editMode ? saveTask() : onSubmit(taskForm)" #taskForm="ngForm" class="task-form">
        <main>
            <div class="left_box">
                <div>
                    <label for="title">Title <span>*</span></label>
                    <input type="text" id="title" name="title" [(ngModel)]="targetTask.title" #titleInput="ngModel"
                        placeholder="Title" required />
                </div>
                <div class="error">
                    <span *ngIf="titleInput.invalid && (titleInput.dirty || titleInput.touched || taskForm.submitted)">
                        {{ titleInput.errors?.['required'] ? 'UPS Vergessen' : '' }}
                    </span>
                </div>

                <div>
                    <label for="description">Description</label>
                    <textarea id="description" name="description" [(ngModel)]="targetTask.description"
                        placeholder="Description" required></textarea>
                </div>

                <div>
                    <label for="date">Due date <span>*</span></label>
                    <input type="date" id="date" name="due_date" [(ngModel)]="targetTask.due_date" #dateInput="ngModel"
                        required />
                </div>
                <div class="error">
                    <span *ngIf="dateInput.invalid && (dateInput.dirty || dateInput.touched || taskForm.submitted)">
                        {{ dateInput.errors?.['required'] ? 'UPS Vergessen' : '' }}
                    </span>
                </div>
            </div>

            <div class="line"></div>

            <div class="right_box">
                <div>
                    <label>Priority</label>
                    <div class="priority-buttons">
                        <button type="button" [class.active_high]="targetTask.priority === 'Urgent'"
                            (click)="targetTask.priority = 'Urgent'">
                            Urgent <img src="/assets/icons/urgent.svg">
                        </button>
                        <button type="button" [class.active_medium]="targetTask.priority === 'Medium'"
                            (click)="targetTask.priority = 'Medium'">
                            Medium <img src="/assets/icons/medium.svg">
                        </button>
                        <button type="button" [class.active_low]="targetTask.priority === 'Low'"
                            (click)="targetTask.priority = 'Low'">
                            Low <img src="/assets/icons/low.svg">
                        </button>
                    </div>
                </div>

                <label>Assigned to</label>
                <ng-select class="ng_select" [items]="contactService.contactsList" bindLabel="name"
                    [(ngModel)]="targetTask.assigned_to" name="assigned_to" placeholder="Select contacts to assign"
                    [multiple]="true" [closeOnSelect]="false" [clearable]="false" [searchable]="true">
                    <ng-template ng-option-tmp let-contact="item">
                        <div class="option-row" (click)="$event.stopPropagation()">
                            <div class="avatar">{{ initials(contact.name) }}</div>
                            <div class="fullname">{{ contact.name }}</div>
                            <input type="checkbox" [checked]="isAssigned(contact)"
                                (click)="$event.stopPropagation(); toggleAssigned(contact)" />
                        </div>
                    </ng-template>
                </ng-select>

                <div class="selected-badges error">
                    <div *ngFor="let it of targetTask.assigned_to; let i = index" class="badge">
                        {{ initials(it.name) }}
                    </div>
                </div>

                <div>
                    <label for="category">Category <span>*</span></label>
                    <select id="category" name="category" [(ngModel)]="targetTask.category" #categoryInput="ngModel"
                        required>
                        <option value="Technical Task">Technical Task</option>
                        <option value="User Story">User Story</option>
                    </select>
                </div>
                <div class="error">
                    <span
                        *ngIf="categoryInput.invalid && (categoryInput.dirty || categoryInput.touched || taskForm.submitted)">
                        {{ categoryInput.errors?.['required'] ? 'UPS Vergessen' : '' }}
                    </span>
                </div>

                <div class="subtasks">
                    <label for="subtask">Subtasks</label>
                    <input type="text" id="subtask" [(ngModel)]="subtaskTitle" name="subtaskTitle"
                        placeholder="Subtask title" />
                    <button type="button" (click)="addSubtask()">Add</button>

                    <ul>
                        <li *ngFor="let subtask of targetTask.subtask; let i = index">
                            {{ subtask.title }}
                            <button type="button" (click)="removeSubtask(i)">x</button>
                        </li>
                    </ul>
                </div>
            </div>
        </main>

        <footer>
            <div>
                <p><span>*</span>This field is required</p>
            </div>
            <div>
                <button class="add_task" type="submit">
                    {{ editMode ? 'Save Changes' : 'Add Task' }}
                    <img src="/assets/icons/button_x_check/button_check.png">
                </button>
            </div>
        </footer>
    </form>
</section>